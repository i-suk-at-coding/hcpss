<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Map Editor</title>
  <style>
    body{margin:0;height:100vh;display:flex;font-family:"Segoe UI",sans-serif;background:#0f0f0f;color:#eee}
    #toolbox{width:200px;background:#1a1a1a;color:#eee;padding:12px;border-right:1px solid #333;display:flex;flex-direction:column;gap:8px}
    #toolbox h3{margin:0 0 8px;font-size:14px}
    #toolbox label{font-size:13px;display:flex;flex-direction:column;gap:4px}
    #toolbox select,#toolbox input{padding:4px;background:#111;color:#eee;border:1px solid #333;border-radius:4px}
    #toolbox button{background:#3b82f6;color:#fff;border:none;border-radius:6px;padding:6px;cursor:pointer;font-size:13px}
    #toolbox button:hover{background:#2563eb}
    #editorArea{flex:1;display:flex;flex-direction:column;background:#1a1a1a}
    #canvas{flex:1;background:#222;border-right:1px solid #333}
    #jsonPanel{width:400px;background:#121212;border-left:1px solid #333;display:flex;flex-direction:column}
    #jsonPanel h3{margin:0;padding:12px;font-size:14px;background:#1f1f1f;border-bottom:1px solid #333}
    #editorOutput{flex:1;width:100%;border:none;resize:none;padding:12px;font-family:monospace;font-size:13px;background:#0f0f0f;color:#eee;overflow:auto;white-space:pre}
    #copyBtn{background:#3b82f6;border:none;color:#fff;padding:8px;cursor:pointer;font-size:13px}
    #copyBtn:hover{background:#2563eb}
  </style>
</head>
<body>
  <div id="toolbox">
    <h3>Tools</h3>
    <label>Material:
      <select id="materialSelect">
        <option value="normal">Normal</option>
        <option value="ice">Ice</option>
        <option value="lava">Lava</option>
        <option value="bounce">Bounce</option>
        <option value="sticky">Sticky</option>
      </select>
    </label>
    <label>Rotation:
      <input type="number" id="rotationInput" value="0" step="5">Â°
    </label>
    <button id="addBtn">Add Platform</button>
    <button id="deleteBtn">Delete Selected</button>
    <button id="saveBtn">Save JSON</button>
  </div>

  <div id="editorArea">
    <canvas id="canvas"></canvas>
  </div>

  <div id="jsonPanel">
    <h3>JSON Output</h3>
    <textarea id="editorOutput" readonly></textarea>
    <button id="copyBtn">Copy JSON</button>
  </div>

  <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const output = document.getElementById('editorOutput');
    const copyBtn = document.getElementById('copyBtn');
    const materialSelect = document.getElementById('materialSelect');
    const rotationInput = document.getElementById('rotationInput');
    const addBtn = document.getElementById('addBtn');
    const deleteBtn = document.getElementById('deleteBtn');
    const saveBtn = document.getElementById('saveBtn');

    let world = { platforms: [] };
    let selectedIndex = null;

    function resizeCanvas() {
      canvas.width = window.innerWidth - document.getElementById('jsonPanel').offsetWidth - document.getElementById('toolbox').offsetWidth;
      canvas.height = window.innerHeight;
      redraw();
    }
    window.addEventListener('resize', resizeCanvas);

    function redraw() {
      ctx.fillStyle = '#222';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      world.platforms.forEach((p, i) => {
        ctx.save();
        ctx.translate(p.x + p.w/2, p.y + p.h/2);
        ctx.rotate(p.rotation * Math.PI/180);
        ctx.fillStyle = p.material === 'ice' ? '#3b82f6'
                     : p.material === 'lava' ? '#ef4444'
                     : p.material === 'bounce' ? '#facc15'
                     : p.material === 'sticky' ? '#10b981'
                     : '#888';
        ctx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
        if (i === selectedIndex) {
          ctx.strokeStyle = '#fff';
          ctx.lineWidth = 2;
          ctx.strokeRect(-p.w/2, -p.h/2, p.w, p.h);
        }
        ctx.restore();
      });

      output.value = JSON.stringify(world.platforms, null, 2);
    }

    addBtn.addEventListener('click', () => {
      const newPlat = {
        x: 100, y: 100, w: 200, h: 20,
        rotation: parseInt(rotationInput.value, 10) || 0,
        material: materialSelect.value
      };
      world.platforms.push(newPlat);
      selectedIndex = world.platforms.length - 1;
      redraw();
    });

    deleteBtn.addEventListener('click', () => {
      if (selectedIndex !== null) {
        world.platforms.splice(selectedIndex, 1);
        selectedIndex = null;
        redraw();
      }
    });

    saveBtn.addEventListener('click', () => {
      output.value = JSON.stringify(world.platforms, null, 2);
    });

    copyBtn.addEventListener('click', () => {
      output.select();
      document.execCommand('copy');
      alert('JSON copied to clipboard!');
    });

    canvas.addEventListener('click', (e) => {
      const rect = canvas.getBoundingClientRect();
      const mx = e.clientX - rect.left;
      const my = e.clientY - rect.top;
      selectedIndex = world.platforms.findIndex(p =>
        mx >= p.x && mx <= p.x + p.w &&
        my >= p.y && my <= p.y + p.h
      );
      redraw();
    });

    resizeCanvas();
  </script>
</body>
</html>
