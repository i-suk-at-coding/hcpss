<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Platformer Map Editor</title>
  <style>
    body { margin:0; background:#111; color:#eee; font-family:sans-serif; display:flex; flex-direction:column; height:100vh; }
    #toolbar { background:#1a1a1a; padding:8px; display:flex; gap:8px; }
    button { background:#3b82f6; color:#fff; border:none; border-radius:4px; padding:6px 10px; cursor:pointer; }
    button:hover { background:#2563eb; }
    #canvas { flex:1; background:#222; cursor:crosshair; }
    textarea { width:100%; height:120px; margin-top:8px; background:#111; color:#eee; border:1px solid #333; }
  </style>
</head>
<body>
  <div id="toolbar">
    <button id="saveBtn">Save Map</button>
    <button id="loadBtn">Load Map</button>
  </div>
  <canvas id="canvas" width="1200" height="700"></canvas>
  <textarea id="output" placeholder="Map JSON will appear here..."></textarea>

  <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const output = document.getElementById('output');

    let platforms = [];
    let selected = null;
    let dragOffset = {x:0,y:0};

    // Draw grid + platforms
    function render() {
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle='#222';
      ctx.fillRect(0,0,canvas.width,canvas.height);

      // grid
      ctx.strokeStyle='#333';
      for(let x=0;x<canvas.width;x+=50){
        ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,canvas.height); ctx.stroke();
      }
      for(let y=0;y<canvas.height;y+=50){
        ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(canvas.width,y); ctx.stroke();
      }

      // platforms
      platforms.forEach(p=>{
        ctx.fillStyle=(p===selected)?'#3b82f6':'#888';
        ctx.fillRect(p.x,p.y,p.w,p.h);
      });

      requestAnimationFrame(render);
    }
    render();

    // Mouse events
    let dragging=false;
    canvas.addEventListener('mousedown',e=>{
      const rect=canvas.getBoundingClientRect();
      const mx=e.clientX-rect.left, my=e.clientY-rect.top;
      selected=platforms.find(p=>mx>=p.x && mx<=p.x+p.w && my>=p.y && my<=p.y+p.h);
      if(selected){
        dragging=true;
        dragOffset.x=mx-selected.x;
        dragOffset.y=my-selected.y;
        if(e.button===2){ // right click delete
          platforms=platforms.filter(p=>p!==selected);
          selected=null;
        }
      } else {
        // add new platform
        platforms.push({x:mx,y:my,w:100,h:20});
      }
    });
    canvas.addEventListener('mousemove',e=>{
      if(dragging && selected){
        const rect=canvas.getBoundingClientRect();
        const mx=e.clientX-rect.left, my=e.clientY-rect.top;
        selected.x=mx-dragOffset.x;
        selected.y=my-dragOffset.y;
      }
    });
    canvas.addEventListener('mouseup',()=>{dragging=false;});
    canvas.addEventListener('contextmenu',e=>e.preventDefault());

    // Save/Load
    document.getElementById('saveBtn').onclick=()=>{
      output.value=JSON.stringify(platforms,null,2);
    };
    document.getElementById('loadBtn').onclick=()=>{
      try{ platforms=JSON.parse(output.value); }catch(e){ alert('Invalid JSON'); }
    };
  </script>
</body>
</html>
