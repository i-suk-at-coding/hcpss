<!DOCTYPE html>
<html>
  <head>
    <title>Live Chat</title>
    <style>
      body {
          font-family: Arial, sans-serif;
          background: #f4f6f8;
          margin: 0;
          padding: 0;
          display: flex;
          flex-direction: column;
          height: 100vh;
        }

      #chat-container {
          flex: 1;
          display: flex;
          flex-direction: column;
          max-width: 600px;
          margin: auto;
          border: 1px solid #ddd;
          background: #fff;
          box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      }

      #messages li {
          margin: 8px 0;
          padding: 10px;
          border-radius: 8px;
          background: #e9f5ff;
      }

      #messages li.self {
          background: #d1ffd6;
          text-align: right;
      }

      #form {
          display: flex;
          border-top: 1px solid #ddd;
      }

      #input {
          flex: 1;
          padding: 10px;
          border: none;
          outline: none;
      }

      button {
          background: #007bff;
          color: white;
          border: none;
          padding: 10px 15px;
          cursor: pointer;
      }

      button:hover {
          background: #0056b3;
      }
    </style>
  </head>
  <body>
  <div id="chat-container">
    <ul id="messages"></ul>
    <form id="form">
      <input id="input" autocomplete="off" placeholder="Type a message..." />
      <button>Send</button>
    </form>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    const form = document.getElementById('form');
    const input = document.getElementById('input');
    const messages = document.getElementById('messages');

    // Ask user for a name
    const username = prompt("Enter your name:") || "Anonymous";

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      if (input.value) {
        socket.emit('chat message', {
          user: username,
          text: input.value,
          time: new Date().toLocaleTimeString()
        });
        input.value = '';
      }
    });

    // Load chat history
    socket.on('chat history', (history) => {
      history.forEach((msg) => addMessage(msg));
    });

    // Handle new messages
    socket.on('chat message', (msg) => {
      addMessage(msg);
    });

    // Function to render messages
    function addMessage(msg) {
      const item = document.createElement('li');
      item.textContent = `[${msg.time}] ${msg.user}: ${msg.text}`;
      if (msg.user === username) {
        item.classList.add('self'); // style your own messages
      }
      messages.appendChild(item);
      messages.scrollTop = messages.scrollHeight;
    }
  </script>
  </body>
</html>
